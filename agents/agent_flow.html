<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post-Parent Support Agent Architecture</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #1E3A5F;
        }

        .description {
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .agent-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .watchdog {
            background-color: #fff0f0;
            border-left: 5px solid #dc3545;
        }

        .input-agent {
            background-color: #f0f8ff;
            border-left: 5px solid #0d6efd;
        }

        .support-agent {
            background-color: #f0fff4;
            border-left: 5px solid #198754;
        }

        .clinical-agent {
            background-color: #fff8e1;
            border-left: 5px solid #ffc107;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Post-Parent Support Agent Team</h1>

        <div class="description">
            <p>ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€å˜ä¸€ã®AIã§ã¯ãªãã€å°‚é–€å½¹å‰²ã‚’æŒã£ãŸ3ã¤ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒãƒ¼ãƒ ã¨ã—ã¦é€£æºã—ã¦å‹•ä½œã—ã¾ã™ã€‚</p>
        </div>

        <div class="mermaid">
            flowchart TD
            %% Node Definitions
            UserNode("ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ (User)")
            MainNode["Orchestrator (Main)"]
            WatchdogNode["ğŸ• EmergencyWatchdog"]
            EmergencyNode["âš¡ Fast Path Protocol"]
            AlertNode["LINEé€šçŸ¥ / æ•‘æ€¥æƒ…å ±è¡¨ç¤º"]
            InputNode["ğŸ“ InputAgent"]
            ParsingNode["Gemini 2.0 Flash"]
            CheckBehaviorNode{"è¡Œå‹•éšœå®³åˆ¤å®š"}
            ClinicalNode["ğŸ©º ClinicalAdvisorAgent"]
            SupportNode["ğŸ§  SupportAgent"]
            WebSearchNode["ğŸŒ DuckDuckGo"]
            Neo4jNode[("Neo4j Graph DB")]
            ContextNode["â“ çŠ¶æ³ç¢ºèª (Context Mining)"]
            ActionNode["ææ¡ˆ / ãƒ­ã‚°è¨˜éŒ²"]

            %% Flow
            UserNode -->|è‡ªç„¶è¨€èªå…¥åŠ›| MainNode
            MainNode -->|1. Check| WatchdogNode

            %% Watchdog Logic
            WatchdogNode -- "SOSæ¤œçŸ¥" --> EmergencyNode
            EmergencyNode -->|å³æ™‚å¯¾å¿œ| AlertNode
            AlertNode --> UserNode

            WatchdogNode -- "å®‰å…¨" --> InputNode
            InputNode -->|2. æŠ½å‡º| ParsingNode
            ParsingNode -->|JSON| CheckBehaviorNode

            %% Behavior Check
            CheckBehaviorNode -- "è¡Œå‹•éšœå®³" --> ClinicalNode
            CheckBehaviorNode -- "é€šå¸¸" --> SupportNode

            %% Clinical Logic
            ClinicalNode <-->|3a. æ¤œç´¢| WebSearchNode
                ClinicalNode <-->|3b. ç…§åˆ| Neo4jNode
                    ClinicalNode -->|4a. çµ±åˆ| ActionNode

                    %% Support Logic (Updated)
                    SupportNode <-->|3. å‚ç…§| Neo4jNode
                        SupportNode -->|4. ææ¡ˆ| ActionNode
                        SupportNode -.->|5. è³ªå• Why| ContextNode

                        %% Feedback Loops
                        ActionNode --> UserNode
                        ContextNode --> UserNode
                        UserNode -.->|6. å›ç­”| SupportNode
                        SupportNode -->|7. è“„ç©| Neo4jNode

                        %% Styling
                        style WatchdogNode fill:#ffe6e6,stroke:#d63384,stroke-width:2px
                        style InputNode fill:#e6f3ff,stroke:#0d6efd,stroke-width:2px
                        style SupportNode fill:#e6fffa,stroke:#00b894,stroke-width:2px
                        style ClinicalNode fill:#fff8e1,stroke:#ffc107,stroke-width:2px
                        style Neo4jNode fill:#fff3cd,stroke:#ffc107,stroke-width:2px
                        style ContextNode fill:#e8f5e9,stroke:#4caf50,stroke-width:2px,stroke-dasharray: 5 5
                        style WebSearchNode fill:#f8f9fa,stroke:#6c757d,stroke-width:1px,stroke-dasharray: 5 5
        </div>

        <div class="description">
            <h3>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²åˆ†æ‹…</h3>

            <div class="agent-card watchdog">
                <strong>ğŸ• EmergencyWatchdog (ç•ªçŠ¬)</strong>
                <p>å…¨ã¦ã®å…¥åŠ›ã®æœ€åˆã«ã€Œç·Šæ€¥æ€§ã€ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚SOSã‚„ãƒ‘ãƒ‹ãƒƒã‚¯ç­‰ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œçŸ¥ã™ã‚‹ã¨ã€è¤‡é›‘ãªæ¨è«–ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦å³åº§ã«å‘½ã‚’å®ˆã‚‹è¡Œå‹•ï¼ˆFast Pathï¼‰ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚</p>
            </div>

            <div class="agent-card input-agent">
                <strong>ğŸ“ InputAgent (æ›¸è¨˜ãƒ»å—ä»˜)</strong>
                <p>æ›–æ˜§ãªç‰©èªèª¿ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è§£ãã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²ã§ãã‚‹å½¢ï¼ˆJSONï¼‰ã«æ•´ç†æ•´é “ã—ã¾ã™ã€‚åŒæ™‚ã«ã€Œç¦å¿Œäº‹é …ã€ã«è§¦ã‚Œã¦ã„ãªã„ã‹ã®å®‰å…¨ãƒã‚§ãƒƒã‚¯ã‚‚è¡Œã„ã¾ã™ã€‚</p>
            </div>

            <div class="agent-card support-agent">
                <strong>ğŸ§  SupportAgent (å‚è¬€ãƒ»ã‚±ã‚¢ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼)</strong>
                <p>éå»ã®è¨˜æ†¶ã‚’å‚ç…§ã—ã€æœ€é©ãªã‚±ã‚¢ãƒ—ãƒ©ãƒ³ã‚’ææ¡ˆã—ã¾ã™ã€‚<strong>ã€ŒContext Miningã€ã«ã‚ˆã‚Šã€æˆåŠŸãƒ»å¤±æ•—ã®è¦å› ï¼ˆæš—é»™çŸ¥ï¼‰ã‚’è³ªå•ã—ã€çŸ¥è­˜ã¨ã—ã¦è“„ç©ã™ã‚‹æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã¾ã™ã€‚</strong>
                </p>
            </div>

            <div class="agent-card clinical-agent">
                <strong>ğŸ©º ClinicalAdvisorAgent (è‡¨åºŠã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼)</strong>
                <p>è¡Œå‹•éšœå®³ï¼ˆãƒ‘ãƒ‹ãƒƒã‚¯ç­‰ï¼‰ã«å¯¾ã—ã€å¤–éƒ¨ã®ç§‘å­¦çš„çŸ¥è¦‹ã¨å†…éƒ¨ã®è¨˜éŒ²ã‚’ã‚¯ãƒ­ã‚¹ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡Œã„ã¾ã™ã€‚</p>
            </div>
        </div>
    </div>

</body>

</html>